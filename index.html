<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shalhevet GPA Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --fire-red: #cc0000; 
            --dark-red: #a30000;
            --black: #1a1a1a; 
            --white: #ffffff;
            --bg: #f4f4f4; 
            --border: #d1d1d1;
            --text-muted: #666666;
        }
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: var(--black); margin: 0; padding: 20px; line-height: 1.5; }
        .container { max-width: 900px; margin: 40px auto; }
        
        /* Stats Dashboard - Red & Black Theme */
        .stats-bar { 
            position: sticky; top: 20px; background: var(--black); 
            padding: 30px; border-radius: 20px; 
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; 
            margin-bottom: 40px; z-index: 1000; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.2); 
            color: var(--white);
        }
        .stat-item { text-align: center; border-right: 1px solid #444; }
        .stat-item:last-child { border-right: none; }
        .stat-value { font-size: 3rem; font-weight: 800; color: var(--fire-red); line-height: 1; margin-bottom: 5px; }
        .stat-label { font-size: 0.8rem; text-transform: uppercase; font-weight: 600; letter-spacing: 0.15em; color: var(--white); }

        /* Semester Card - Clean White with Red Header */
        .semester-card { background: var(--white); border-radius: 20px; padding: 0; margin-bottom: 30px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .sem-header { background: #fdfdfd; padding: 20px 32px; border-bottom: 2px solid var(--bg); display: flex; justify-content: space-between; align-items: center; }
        
        /* SPACING FIX: Separated Year and Term */
        .sem-title-group { display: flex; gap: 24px; align-items: center; }
        .selector-box { display: flex; flex-direction: column; gap: 4px; }
        .selector-label { font-size: 10px; font-weight: 800; color: var(--fire-red); text-transform: uppercase; letter-spacing: 0.05em; }

        .select-styled { background: var(--white); border: 1px solid var(--border); padding: 8px 12px; border-radius: 8px; font-weight: 600; color: var(--black); cursor: pointer; font-size: 0.9rem; }
        .select-styled:focus { border-color: var(--fire-red); outline: none; }

        .courses-container { padding: 32px; }
        .course-row { display: grid; grid-template-columns: 3fr 1.2fr 1fr 0.8fr 40px; gap: 15px; margin-bottom: 15px; align-items: flex-end; }
        
        input, select { background: var(--white); border: 1px solid var(--border); padding: 12px; border-radius: 10px; font-family: inherit; font-size: 0.95rem; color: var(--black); }
        input:focus { border-color: var(--fire-red); outline: none; }
        
        /* Red Checkbox UI */
        .weight-toggle { display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); height: 46px; border-radius: 10px; cursor: pointer; font-size: 11px; font-weight: 800; color: var(--text-muted); transition: 0.2s; }
        .weight-toggle:has(input:checked) { background: var(--fire-red); border-color: var(--fire-red); color: white; }
        .weight-toggle input { display: none; }

        /* Buttons */
        button { font-family: inherit; cursor: pointer; border: none; border-radius: 12px; padding: 12px 20px; font-weight: 700; transition: 0.2s; }
        .btn-add-sem { background: var(--fire-red); color: white; width: 100%; padding: 18px; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; }
        .btn-add-sem:hover { background: var(--dark-red); }
        .btn-add-course { background: transparent; color: var(--fire-red); border: 2px dashed var(--border); width: 100%; margin-top: 10px; }
        .btn-add-course:hover { border-color: var(--fire-red); background: #fffafa; }
        .btn-delete-sem { background: transparent; color: var(--text-muted); font-size: 0.8rem; border: 1px solid var(--border); padding: 6px 12px; }
        .btn-delete-sem:hover { color: var(--fire-red); border-color: var(--fire-red); }
        .btn-delete-course { color: var(--text-muted); background: none; font-size: 1.2rem; }
        .btn-delete-course:hover { color: var(--fire-red); }

        .controls { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-top: 30px; }

        @media (max-width: 768px) { 
            .course-row { grid-template-columns: 1fr 1fr; gap: 10px; } 
            .course-row .input-group:first-child { grid-column: span 2; }
            .sem-title-group { gap: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 40px;">
        <h1 style="margin: 0; color: var(--black); font-size: 2.5rem; font-weight: 800;">GPA <span style="color: var(--fire-red);">TRACKER</span></h1>
        <p style="color: var(--text-muted); margin-top: 5px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px;">Shalhevet High School</p>
    </div>

    <div class="stats-bar">
        <div class="stat-item"><div class="stat-label">Unweighted</div><div class="stat-value" id="overall-unweighted">0.00</div></div>
        <div class="stat-item"><div class="stat-label">Weighted</div><div class="stat-value" id="overall-weighted">0.00</div></div>
    </div>

    <div id="semesters-container"></div>

    <div class="controls">
        <button class="btn-add-sem" onclick="addSemester()">+ Add New Semester</button>
        <button style="background: var(--black); color: white;" onclick="copyLink()">Share Link</button>
        <button style="background: white; color: var(--black); border: 2px solid var(--black);" onclick="clearAll()">Reset All</button>
    </div>
</div>

<datalist id="course-list"></datalist>

<script>
    const schoolCourses = ["English Composition", "English Composition (Honors)", "American Literature", "American Literature (Honors)", "Banned Books", "Banned Books (Honors)", "British Literature (SAS)", "Journalism (Honors/Reg)", "Creative Writing", "Film, Literature & Composition", "Film, Literature & Composition (Honors)", "Jewish Literature (SAS)", "World History", "US History", "US History (Honors)", "Civics (SAS)", "Civil War and Reconstruction (SAS)", "Eurasia (SAS)", "Economics (SAS)", "Medieval Jewish History (SAS)", "Positive Psychology", "Psychology (SAS)", "Topics in US History (SAS)", "US Government & Economics", "Biology", "Biology (SAS)", "Chemistry", "Chemistry (Honors)", "Chemistry (SAS)", "Physics", "Physics (SAS)", "Anatomy and Physiology (Honors)", "Biochemistry (SAS)", "Environmental Science", "Computer Science Principles (Honors)", "Computer Science (SAS)", "Computer Organization (SAS)", "Engineering", "Algebra 1", "Geometry", "Geometry (Advanced)", "Geometry (Honors)", "Algebra 2", "Algebra 2 (Advanced)", "Algebra 2 (Honors)", "Precalculus", "Precalculus (Advanced)", "Precalculus (Honors)", "Calculus", "Calculus (SAS)", "Statistics (SAS)", "Multivariable Calculus (SAS)", "Visual Art", "Art Comp & Design", "Art History (Honors)", "Studio Art (SAS)", "Drama", "Hebrew Language", "Hebrew Literature (Honors)", "Hebrew Film & Literature (SAS)", "Israeli Culture & Conversation", "Jewish History", "Modern Jewish History", "Israel Ed", "Israel Ed (SAS)", "Talmud 1", "Talmud 2", "Talmud 2 (Advanced)", "Talmud 3", "Talmud 3 (Advanced)", "Talmud 4", "Talmud 4 (Advanced)", "Tanach 1", "Tanach 2", "Tanach 2 (Advanced)", "Tanach 3", "Tanach 3 (Advanced)", "Tanach 4", "Jewish Philosophy", "Advanced Jewish Philosophy", "AGS (Advanced Gemara Shiur)", "BMT (Beit Midrash Track)"];
    const gradeScale = { "A": 4.0, "A-": 3.67, "B+": 3.33, "B": 3.0, "B-": 2.67, "C+": 2.33, "C": 2.0, "C-": 1.67, "D+": 1.33, "D": 1.0, "F": 0.0 };
    const years = ["9th Grade", "10th Grade", "11th Grade", "12th Grade"];

    let semesters = JSON.parse(localStorage.getItem('shalhevet_v11')) || [];

    function save() {
        localStorage.setItem('shalhevet_v11', JSON.stringify(semesters));
        calculateGPA();
    }

    function addSemester() {
        const nextYear = semesters.length > 0 ? semesters[semesters.length-1].year : years[0];
        semesters.push({ id: Date.now(), year: nextYear, term: "Semester 1", courses: [{ name: '', grade: 'A', credits: 0.5, isHonors: false }] });
        render(); save();
    }

    function updateCourse(semId, idx, field, value) {
        const sem = semesters.find(s => s.id === semId);
        const course = sem.courses[idx];
        course[field] = value;
        if (field === 'name') {
            const n = value.toLowerCase();
            // ONLY Honors or SAS gets the weight. Advanced track is 4.0.
            course.isHonors = (n.includes("honors") || n.includes("sas"));
            render();
        }
        save();
    }

    function calculateGPA() {
        let totalCredits = 0, totalUwPoints = 0, totalWPoints = 0;
        semesters.forEach(sem => {
            sem.courses.forEach(c => {
                const creds = parseFloat(c.credits) || 0;
                const baseValue = gradeScale[c.grade] || 0;
                totalCredits += creds;
                totalUwPoints += (baseValue * creds);
                const weight = (c.isHonors && baseValue >= 1.67) ? 1.0 : 0;
                totalWPoints += ((baseValue + weight) * creds);
            });
        });
        // Single division at the end to ensure 3.82 precision
        const finalUw = totalCredits ? (Math.round((totalUwPoints / totalCredits) * 100) / 100).toFixed(2) : "0.00";
        const finalW = totalCredits ? (Math.round((totalWPoints / totalCredits) * 100) / 100).toFixed(2) : "0.00";
        document.getElementById('overall-unweighted').innerText = finalUw;
        document.getElementById('overall-weighted').innerText = finalW;
    }

    function render() {
        const container = document.getElementById('semesters-container');
        container.innerHTML = '';
        semesters.forEach((sem) => {
            const div = document.createElement('div');
            div.className = 'semester-card';
            div.innerHTML = `
                <div class="sem-header">
                    <div class="sem-title-group">
                        <div class="selector-box">
                            <span class="selector-label">Grade Level</span>
                            <select class="select-styled" onchange="updateSemInfo(${sem.id}, 'year', this.value)">
                                ${years.map(y => `<option value="${y}" ${sem.year === y ? 'selected' : ''}>${y}</option>`).join('')}
                            </select>
                        </div>
                        <div class="selector-box">
                            <span class="selector-label">Term</span>
                            <select class="select-styled" onchange="updateSemInfo(${sem.id}, 'term', this.value)">
                                <option ${sem.term === 'Semester 1' ? 'selected' : ''}>Semester 1</option>
                                <option ${sem.term === 'Semester 2' ? 'selected' : ''}>Semester 2</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn-delete-sem" onclick="deleteSem(${sem.id})">Delete Semester</button>
                </div>
                <div class="courses-container">
                    ${sem.courses.map((c, cIdx) => `
                        <div class="course-row">
                            <div class="input-group">
                                <span class="selector-label">Course Name</span>
                                <input type="text" list="course-list" placeholder="Start typing..." value="${c.name}" onchange="updateCourse(${sem.id}, ${cIdx}, 'name', this.value)">
                            </div>
                            <div class="input-group">
                                <span class="selector-label">Grade</span>
                                <select onchange="updateCourse(${sem.id}, ${cIdx}, 'grade', this.value)">
                                    ${Object.keys(gradeScale).map(g => `<option value="${g}" ${c.grade === g ? 'selected' : ''}>${g}</option>`).join('')}
                                </select>
                            </div>
                            <div class="input-group">
                                <span class="selector-label">Credits</span>
                                <input type="number" step="0.1" value="${c.credits}" oninput="updateCourse(${sem.id}, ${cIdx}, 'credits', this.value)">
                            </div>
                            <div class="input-group">
                                <span class="selector-label">Weight</span>
                                <label class="weight-toggle">
                                    <input type="checkbox" ${c.isHonors ? 'checked' : ''} onchange="updateCourse(${sem.id}, ${cIdx}, 'isHonors', this.checked)">
                                    ${c.isHonors ? 'HONORS' : 'REG'}
                                </label>
                            </div>
                            <button class="btn-delete-course" onclick="deleteCourse(${sem.id}, ${cIdx})">âœ•</button>
                        </div>
                    `).join('')}
                    <button class="btn-add-course" onclick="addCourse(${sem.id})">+ Add New Class</button>
                </div>
            `;
            container.appendChild(div);
        });
        const dl = document.getElementById('course-list');
        dl.innerHTML = schoolCourses.map(c => `<option value="${c}">`).join('');
        calculateGPA();
    }

    function updateSemInfo(id, f, v) { semesters.find(s => s.id === id)[f] = v; save(); }
    function addCourse(id) { semesters.find(s => s.id === id).courses.push({ name: '', grade: 'A', credits: 0.5, isHonors: false }); render(); save(); }
    function deleteCourse(id, idx) { semesters.find(s => s.id === id).courses.splice(idx, 1); render(); save(); }
    function deleteSem(id) { if(confirm("Permanently delete this semester?")) { semesters = semesters.filter(s => s.id !== id); render(); save(); } }
    function copyLink() { navigator.clipboard.writeText(window.location.href); alert("Share link copied to clipboard!"); }
    function clearAll() { if(confirm("Wipe all data? This cannot be undone.")) { semesters = []; addSemester(); save(); } }

    if(semesters.length === 0) addSemester(); else render();
</script>
</body>
</html>
