<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shalhevet GPA Tracker | Master Verified</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --fire-red: #cc0000; --black: #1a1a1a; --white: #ffffff; --bg: #f4f4f4; --border: #d1d1d1; --text-muted: #666666; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: var(--black); margin: 0; padding: 20px; line-height: 1.5; }
        .container { max-width: 1000px; margin: 40px auto; }
        
        /* Sticky Dashboard */
        .stats-bar { position: sticky; top: 20px; background: var(--black); padding: 25px; border-radius: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; z-index: 1000; box-shadow: 0 15px 30px rgba(0,0,0,0.2); color: var(--white); }
        .stat-item { text-align: center; border-right: 1px solid #444; }
        .stat-item:last-child { border-right: none; }
        .stat-value { font-size: 2.8rem; font-weight: 800; color: var(--fire-red); line-height: 1; }
        .stat-label { font-size: 0.75rem; text-transform: uppercase; font-weight: 600; letter-spacing: 0.15em; margin-top: 5px; }

        .year-summary-bar { background: #e2e2e2; border: 2px solid var(--black); padding: 15px 25px; border-radius: 12px; margin: -10px 0 35px 0; display: flex; justify-content: space-between; align-items: center; font-weight: 800; font-size: 0.95rem; text-transform: uppercase; }
        .year-summary-bar span { color: var(--fire-red); }

        .semester-card { background: var(--white); border-radius: 20px; margin-bottom: 25px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .sem-header { background: #fdfdfd; padding: 15px 32px; border-bottom: 2px solid var(--bg); display: flex; justify-content: space-between; align-items: center; }
        .selector-label { font-size: 10px; font-weight: 800; color: var(--fire-red); text-transform: uppercase; margin-bottom: 4px; }
        .select-styled { background: var(--white); border: 1px solid var(--border); padding: 6px 10px; border-radius: 8px; font-weight: 600; font-family: inherit; }

        .courses-container { padding: 25px 32px; }
        .course-row { display: grid; grid-template-columns: 3.5fr 110px 100px 85px 40px; gap: 15px; margin-bottom: 15px; align-items: flex-end; }
        input, select { background: var(--white); border: 1px solid var(--border); padding: 10px; border-radius: 8px; font-family: inherit; font-size: 0.9rem; width: 100%; }

        .weight-toggle { display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); height: 40px; border-radius: 8px; cursor: pointer; font-size: 10px; font-weight: 800; color: var(--text-muted); }
        .weight-toggle:has(input:checked) { background: var(--fire-red); border-color: var(--fire-red); color: white; }
        .weight-toggle input { display: none; }

        button { cursor: pointer; border: none; border-radius: 10px; padding: 10px 18px; font-weight: 700; transition: 0.2s; }
        .btn-add-sem { background: var(--fire-red); color: white; width: 100%; padding: 15px; font-size: 1rem; text-transform: uppercase; margin-bottom: 40px; }
        .btn-add-course { background: transparent; color: var(--fire-red); border: 1px dashed var(--fire-red); width: 100%; margin-top: 5px; }
        .btn-delete { color: var(--text-muted); background: none; font-size: 1.1rem; }

        .info-section { background: var(--white); border-radius: 20px; padding: 40px; border: 1px solid var(--border); margin-top: 20px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 40px; }
        .gpa-chart { width: 100%; border-collapse: collapse; font-size: 0.9rem; margin-top: 10px; }
        .gpa-chart th { text-align: left; padding: 12px; border-bottom: 2px solid var(--fire-red); font-weight: 800; text-transform: uppercase; }
        .gpa-chart td { padding: 10px; border-bottom: 1px solid #f0f0f0; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="margin: 0; font-size: 2.2rem; font-weight: 800;">GPA <span style="color: var(--fire-red);">TRACKER</span></h1>
        <p style="color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Official Shalhevet Standards</p>
    </div>

    <div class="stats-bar">
        <div class="stat-item"><div class="stat-label">Cumulative UW</div><div class="stat-value" id="overall-unweighted">0.00</div></div>
        <div class="stat-item"><div class="stat-label">Cumulative Weighted</div><div class="stat-value" id="overall-weighted">0.00</div></div>
    </div>

    <div id="main-content"></div>
    <button class="btn-add-sem" onclick="addSemester()">+ Add New Semester</button>

    <div class="info-section">
        <div class="info-grid">
            <div>
                <h3 style="margin-top:0; color: var(--fire-red);">How the System Works</h3>
                <ul style="font-size: 0.85rem; padding-left: 0; list-style: none; color: var(--text-muted); line-height: 1.8;">
                    <li style="margin-bottom: 10px;"><b style="color: var(--black);">Unweighted (REG):</b> Based on a standard 4.0 scale.</li>
                    <li style="margin-bottom: 10px;"><b style="color: var(--black);">Weighted (WT):</b> Grants an extra 1.0 point to SAS and Honors courses.</li>
                    <li style="margin-bottom: 10px;"><b style="color: var(--black);">Advanced Track:</b> Noted as unweighted per school policy.</li>
                    <li style="margin-bottom: 10px;"><b style="color: var(--black);">Verification:</b> Built-in precision logic ensures rounding accuracy ($3.815 \rightarrow 3.82$).</li>
                </ul>
                <p style="font-size: 0.75rem; font-style: italic; margin-top: 20px; border-top: 1px solid #eee; pt: 10px;"><b>Disclaimer:</b> Planning purposes only. Official GPA is determined by the Registrar's transcript.</p>
            </div>
            <div>
                <table class="gpa-chart">
                    <thead><tr><th>Grade</th><th>UW Pts</th><th>SAS/Honors</th></tr></thead>
                    <tbody>
                        <tr><td>A / A+</td><td>4.00</td><td>5.00</td></tr>
                        <tr><td>A-</td><td>3.67</td><td>4.67</td></tr>
                        <tr><td>B+</td><td>3.33</td><td>4.33</td></tr>
                        <tr><td>B</td><td>3.00</td><td>4.00</td></tr>
                        <tr><td>B-</td><td>2.67</td><td>3.67</td></tr>
                        <tr><td>C+</td><td>2.33</td><td>3.33</td></tr>
                        <tr><td>C</td><td>2.00</td><td>3.00</td></tr>
                        <tr><td>C-</td><td>1.67</td><td>2.67</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const gradeScale = { "A+": 4.0, "A": 4.0, "A-": 3.67, "B+": 3.33, "B": 3.0, "B-": 2.67, "C+": 2.33, "C": 2.0, "C-": 1.67, "D+": 1.33, "D": 1.0, "F": 0.0 };
    const years = ["9th Grade", "10th Grade", "11th Grade", "12th Grade"];
    let semesters = JSON.parse(localStorage.getItem('shalhevet_master_v12')) || [];

    function save() {
        localStorage.setItem('shalhevet_master_v12', JSON.stringify(semesters));
        calculate();
    }

    function formatGPA(num) {
        return (Math.round((num + Number.EPSILON) * 100) / 100).toFixed(2);
    }

    function addSemester() {
        const lastYear = semesters.length > 0 ? semesters[semesters.length-1].year : years[0];
        semesters.push({ id: Date.now(), year: lastYear, term: "Semester 1", courses: [{ name: '', grade: 'A', credits: 0.5, isHonors: false }] });
        save();
    }

    function updateCourse(semId, idx, field, value) {
        const sem = semesters.find(s => s.id === semId);
        sem.courses[idx][field] = value;
        save();
    }

    function calculate() {
        let totalCreds = 0, totalUwPts = 0, totalWPts = 0;
        let yearStats = {};

        semesters.forEach(sem => {
            let sCr = 0, sUw = 0, sW = 0;
            sem.courses.forEach(c => {
                const cr = parseFloat(c.credits) || 0;
                const pts = gradeScale[c.grade] || 0;
                const wt = (c.isHonors && pts >= 1.67) ? 1.0 : 0;
                sCr += cr; sUw += (pts * cr); sW += ((pts + wt) * cr);
            });
            sem.resUw = sCr ? (sUw / sCr) : 0;
            sem.resW = sCr ? (sW / sCr) : 0;

            if(!yearStats[sem.year]) yearStats[sem.year] = { cr: 0, uw: 0, w: 0 };
            yearStats[sem.year].cr += sCr; yearStats[sem.year].uw += sUw; yearStats[sem.year].w += sW;
            totalCreds += sCr; totalUwPts += sUw; totalWPts += sW;
        });

        document.getElementById('overall-unweighted').innerText = totalCreds ? formatGPA(totalUwPts / totalCreds) : "0.00";
        document.getElementById('overall-weighted').innerText = totalCreds ? formatGPA(totalWPts / totalCreds) : "0.00";
        render(yearStats);
    }

    function render(yearStats) {
        const cont = document.getElementById('main-content');
        cont.innerHTML = '';
        years.forEach(y => {
            const yearSems = semesters.filter(s => s.year === y);
            if (!yearSems.length) return;
            yearSems.forEach(sem => {
                const div = document.createElement('div');
                div.className = 'semester-card';
                div.innerHTML = `
                    <div class="sem-header">
                        <div style="display:flex; gap:15px; align-items:center;">
                            <div style="display:flex; flex-direction:column;">
                                <span class="selector-label">Grade</span>
                                <select class="select-styled" onchange="updateSemInfo(${sem.id}, 'year', this.value)">
                                    ${years.map(yr => `<option value="${yr}" ${sem.year === yr ? 'selected' : ''}>${yr}</option>`).join('')}
                                </select>
                            </div>
                            <div style="display:flex; flex-direction:column;">
                                <span class="selector-label">Term</span>
                                <select class="select-styled" onchange="updateSemInfo(${sem.id}, 'term', this.value)">
                                    <option ${sem.term === 'Semester 1' ? 'selected' : ''}>Semester 1</option>
                                    <option ${sem.term === 'Semester 2' ? 'selected' : ''}>Semester 2</option>
                                </select>
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; align-items:center">
                            <div class="sem-badge">UW: ${formatGPA(sem.resUw)}</div>
                            <button class="btn-delete" onclick="deleteSem(${sem.id})">✕</button>
                        </div>
                    </div>
                    <div class="courses-container">
                        ${sem.courses.map((c, i) => `
                            <div class="course-row">
                                <div style="display:flex; flex-direction:column;"><span class="selector-label">Course Name</span>
                                    <input type="text" value="${c.name}" onchange="updateCourse(${sem.id}, ${i}, 'name', this.value)">
                                </div>
                                <div style="display:flex; flex-direction:column;"><span class="selector-label">Grade</span>
                                    <select onchange="updateCourse(${sem.id}, ${i}, 'grade', this.value)">
                                        ${Object.keys(gradeScale).map(g => `<option ${c.grade === g ? 'selected' : ''}>${g}</option>`).join('')}
                                    </select>
                                </div>
                                <div style="display:flex; flex-direction:column;"><span class="selector-label">Credits</span>
                                    <select onchange="updateCourse(${sem.id}, ${i}, 'credits', this.value)">
                                        <option value="0.5" ${c.credits == 0.5 ? 'selected' : ''}>0.5</option>
                                        <option value="0.25" ${c.credits == 0.25 ? 'selected' : ''}>0.25</option>
                                        <option value="1.0" ${c.credits == 1.0 ? 'selected' : ''}>1.0</option>
                                    </select>
                                </div>
                                <div style="display:flex; flex-direction:column;"><span class="selector-label">Weight</span>
                                    <label class="weight-toggle">
                                        <input type="checkbox" ${c.isHonors ? 'checked' : ''} onchange="updateCourse(${sem.id}, ${i}, 'isHonors', this.checked)">
                                        ${c.isHonors ? 'WT' : 'REG'}
                                    </label>
                                </div>
                                <button class="btn-delete" onclick="deleteCourse(${sem.id}, ${i})">✕</button>
                            </div>
                        `).join('')}
                        <button class="btn-add-course" onclick="addCourse(${sem.id})">+ Add Course</button>
                    </div>`;
                cont.appendChild(div);
            });
            const yDiv = document.createElement('div');
            yDiv.className = 'year-summary-bar';
            yDiv.innerHTML = `${y} TOTAL <span>UW: ${formatGPA(yearStats[y].uw / yearStats[y].cr)} | W: ${formatGPA(yearStats[y].w / yearStats[y].cr)}</span>`;
            cont.appendChild(yDiv);
        });
    }

    function updateSemInfo(id, f, v) { semesters.find(s => s.id === id)[f] = v; save(); }
    function addCourse(id) { semesters.find(s => s.id === id).courses.push({ name: '', grade: 'A', credits: 0.5, isHonors: false }); save(); }
    function deleteCourse(id, i) { semesters.find(s => s.id === id).courses.splice(i, 1); save(); }
    function deleteSem(id) { if(confirm("Delete semester?")) { semesters = semesters.filter(s => s.id !== id); save(); } }
    
    if(!semesters.length) addSemester(); else calculate();
</script>
</body>
</html>
