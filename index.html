<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shalhevet GPA Tracker</title>
    <style>
        :root {
            --primary: #4f46e5;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #0f172a;
            --danger: #ef4444;
            --success: #10b981;
            --accent: #6366f1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container { max-width: 850px; width: 100%; }

        .header { text-align: center; margin-bottom: 30px; }

        .stats-bar {
            position: sticky;
            top: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            z-index: 1000;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .stat-item { text-align: center; border-right: 1px solid #e2e8f0; }
        .stat-item:last-child { border-right: none; }
        .stat-value { font-size: 2rem; font-weight: 800; color: var(--primary); }
        .stat-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; opacity: 0.6; }

        .semester-card {
            background: var(--card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .sem-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f8fafc;
        }

        .sem-title-group h2 { margin: 0; font-size: 1.25rem; }
        
        .sem-stats-badge {
            background: #f8fafc;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--accent);
            font-weight: 600;
            border: 1px solid #e2e8f0;
            margin-top: 5px;
            display: inline-block;
        }

        .course-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }

        input, select {
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 14px;
        }

        button {
            cursor: pointer;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-weight: 600;
            transition: 0.2s;
        }

        .btn-add { background: var(--primary); color: white; }
        .btn-add:hover { opacity: 0.9; }
        .btn-delete { background: #fee2e2; color: var(--danger); font-size: 0.8rem; }
        .btn-delete:hover { background: var(--danger); color: white; }
        
        .controls { display: flex; gap: 12px; justify-content: center; margin-top: 40px; margin-bottom: 60px; }

        @media (max-width: 600px) {
            .course-row { grid-template-columns: 1fr; border-bottom: 1px solid #eee; padding-bottom: 15px; }
            .stats-bar { grid-template-columns: 1fr; gap: 10px; }
            .stat-item { border-right: none; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; }
            .stat-item:last-child { border-bottom: none; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Shalhevet GPA Tracker</h1>
        <p style="opacity: 0.7;">Cumulative and Semester-specific breakdown.</p>
    </div>

    <div class="stats-bar">
        <div class="stat-item">
            <div class="stat-label">Total Unweighted</div>
            <div class="stat-value" id="overall-unweighted">0.00</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Total Honors (Weighted)</div>
            <div class="stat-value" id="overall-weighted">0.00</div>
        </div>
    </div>

    <div id="semesters-container"></div>

    <div class="controls">
        <button class="btn-add" onclick="addSemester()">+ New Semester</button>
        <button style="background: var(--success); color: white;" onclick="copyLink()">ðŸ”— Copy Link</button>
        <button style="background: #94a3b8; color: white;" onclick="clearAll()">Reset All</button>
    </div>
</div>

<script>
    const gradeScale = {
        "A": 4.00, "A-": 3.67, "B+": 3.33, "B": 3.00, "B-": 2.67, 
        "C+": 2.33, "C": 2.00, "C-": 1.67, "D+": 1.33, "D": 1.00, "F": 0.00
    };

    let semesters = JSON.parse(localStorage.getItem('shalhevet_gpa_data')) || [];

    function save() {
        localStorage.setItem('shalhevet_gpa_data', JSON.stringify(semesters));
        calculateGPA();
    }

    function addSemester() {
        semesters.push({ id: Date.now(), courses: [{ name: '', grade: 'A', credits: 0.5, isHonors: false }] });
        render();
        save();
    }

    function deleteSemester(id) {
        if(confirm("Delete this entire semester?")) {
            semesters = semesters.filter(s => s.id !== id);
            render();
            save();
        }
    }

    function addCourse(semId) {
        const sem = semesters.find(s => s.id === semId);
        sem.courses.push({ name: '', grade: 'A', credits: 0.5, isHonors: false });
        render();
        save();
    }

    function deleteCourse(semId, idx) {
        const sem = semesters.find(s => s.id === semId);
        sem.courses.splice(idx, 1);
        render();
        save();
    }

    function updateCourse(semId, idx, field, value) {
        const sem = semesters.find(s => s.id === semId);
        sem.courses[idx][field] = value;
        save();
    }

    function calculateGPA() {
        let totalCredits = 0;
        let unweightedPoints = 0;
        let weightedPoints = 0;

        semesters.forEach(sem => {
            let semCredits = 0;
            let semUnweighted = 0;
            let semWeighted = 0;

            sem.courses.forEach(c => {
                const creds = parseFloat(c.credits) || 0;
                const base = gradeScale[c.grade] || 0;
                const weight = (c.isHonors && base > 0) ? 1.0 : 0;

                semCredits += creds;
                semUnweighted += (base * creds);
                semWeighted += ((base + weight) * creds);
            });

            // Store individual semester calcs for the render function
            sem.gpaUnweighted = semCredits ? (semUnweighted / semCredits).toFixed(2) : "0.00";
            sem.gpaWeighted = semCredits ? (semWeighted / semCredits).toFixed(2) : "0.00";

            totalCredits += semCredits;
            unweightedPoints += semUnweighted;
            weightedPoints += semWeighted;
        });

        document.getElementById('overall-unweighted').innerText = totalCredits ? (unweightedPoints / totalCredits).toFixed(2) : "0.00";
        document.getElementById('overall-weighted').innerText = totalCredits ? (weightedPoints / totalCredits).toFixed(2) : "0.00";
    }

    function render() {
        calculateGPA(); // Ensure calculations are fresh
        const container = document.getElementById('semesters-container');
        container.innerHTML = '';

        semesters.forEach((sem, sIdx) => {
            const div = document.createElement('div');
            div.className = 'semester-card';
            div.innerHTML = `
                <div class="sem-header">
                    <div class="sem-title-group">
                        <h2>Semester ${sIdx + 1}</h2>
                        <div class="sem-stats-badge">
                            Sem GPA: ${sem.gpaUnweighted} (UW) | ${sem.gpaWeighted} (W)
                        </div>
                    </div>
                    <button class="btn-delete" onclick="deleteSemester(${sem.id})">Remove Sem</button>
                </div>
                ${sem.courses.map((c, cIdx) => `
                    <div class="course-row">
                        <input type="text" placeholder="Class Name" value="${c.name}" oninput="updateCourse(${sem.id}, ${cIdx}, 'name', this.value)">
                        <select onchange="updateCourse(${sem.id}, ${cIdx}, 'grade', this.value)">
                            ${Object.keys(gradeScale).map(g => `<option value="${g}" ${c.grade === g ? 'selected' : ''}>${g}</option>`).join('')}
                        </select>
                        <input type="number" step="0.1" placeholder="Credits" value="${c.credits}" oninput="updateCourse(${sem.id}, ${cIdx}, 'credits', this.value)">
                        <label style="font-size: 13px; cursor:pointer"><input type="checkbox" ${c.isHonors ? 'checked' : ''} onchange="updateCourse(${sem.id}, ${cIdx}, 'isHonors', this.checked)"> Honors</label>
                        <button class="btn-delete" onclick="deleteCourse(${sem.id}, ${cIdx})">âœ•</button>
                    </div>
                `).join('')}
                <button class="btn-add" style="margin-top:15px; background: #64748b;" onclick="addCourse(${sem.id})">+ Add Class</button>
            `;
            container.appendChild(div);
        });
    }

    function copyLink() {
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert("Link copied! Share this URL with others.");
        });
    }

    function clearAll() {
        if(confirm("This will wipe all your saved grades. Are you sure?")) {
            semesters = [];
            addSemester();
            save();
        }
    }

    if(semesters.length === 0) addSemester(); else render();
</script>
</body>
</html>
