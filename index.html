<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shalhevet GPA Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --fire-red: #cc0000; --black: #1a1a1a; --white: #ffffff; --bg: #f8f8f8; --border: #e0e0e0; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); padding: 20px; color: var(--black); line-height: 1.6; }
        .container { max-width: 1050px; margin: auto; }

        /* Dashboard */
        .dashboard { position: sticky; top: 20px; background: var(--black); color: white; padding: 25px; border-radius: 20px; display: flex; justify-content: space-around; align-items: center; z-index: 1000; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .gpa-stat { text-align: center; flex: 1; }
        .gpa-stat:first-child { border-right: 1px solid #444; }
        .gpa-val { font-size: 3.2rem; font-weight: 800; color: var(--fire-red); line-height: 1; }
        .gpa-label { font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase; margin-top: 8px; opacity: 0.8; }

        /* Policy Info Card */
        .info-card { background: white; padding: 20px; border-radius: 15px; border: 1px solid var(--border); margin-bottom: 30px; }
        .info-card h3 { margin-top: 0; font-size: 13px; text-transform: uppercase; color: var(--fire-red); border-bottom: 2px solid var(--fire-red); display: inline-block; padding-bottom: 4px; margin-bottom: 15px; }
        .info-list { font-size: 13px; color: #555; margin: 0; padding-left: 18px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .info-list li { margin-bottom: 5px; }

        /* Table UI */
        .year-card { background: white; border: 1px solid var(--border); border-radius: 18px; margin-bottom: 35px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .year-header { background: #fdfdfd; padding: 18px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .year-title { font-weight: 800; font-size: 1.1rem; }
        
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 10px; text-transform: uppercase; color: #999; padding: 12px 25px; border-bottom: 1px solid #f0f0f0; }
        td { padding: 12px 25px; border-bottom: 1px solid #f5f5f5; }
        
        .sem-tag { background: #fff5f5; padding: 8px 25px; font-size: 11px; font-weight: 800; color: var(--fire-red); text-transform: uppercase; border-bottom: 1px solid #eee; }
        
        input, select { border: 1px solid #ddd; padding: 10px; border-radius: 8px; width: 100%; font-family: inherit; font-size: 14px; outline: none; transition: all 0.2s; }
        input:focus { border-color: var(--fire-red); background: #fffcfc; }

        .wt-toggle { cursor: pointer; padding: 8px; border-radius: 8px; font-size: 10px; font-weight: 800; text-align: center; background: #f0f0f0; border: 1px solid #ddd; user-select: none; transition: 0.2s; }
        .wt-toggle.active { background: var(--fire-red); color: white; border-color: var(--fire-red); }
        
        .sem-footer { background: #fafafa; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .sem-stats { display: flex; gap: 20px; font-size: 12px; font-weight: 700; color: #666; }
        .btn-add { background: white; border: 1px dashed #ccc; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: 700; color: #888; transition: 0.2s; }
        .btn-add:hover { border-color: var(--fire-red); color: var(--fire-red); }

        .del-btn { color: #ccc; cursor: pointer; border: none; background: none; font-size: 20px; transition: 0.2s; }
        .del-btn:hover { color: var(--fire-red); }

        .disclaimer-box { font-size: 11px; color: #999; text-align: center; padding: 40px 20px; border-top: 1px solid var(--border); margin-top: 20px; }
        .reset-btn { display: block; margin: 0 auto; background: none; border: 1px solid #ffcccc; color: #cc0000; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: 600; }
    </style>
</head>
<body>

<datalist id="catalog">
    <option value="Tanakh 1">
    <option value="Tanakh 1 (Advanced)">
    <option value="Tanakh 2">
    <option value="Tanakh 2 (Advanced)">
    <option value="Tanakh 3">
    <option value="Tanakh 3 (Advanced)">
    <option value="Tanakh 4">
    <option value="Tanakh 4 (Advanced)">
    
    <option value="Talmud 1">
    <option value="Talmud 1 (Advanced)">
    <option value="Talmud 2">
    <option value="Talmud 2 (Advanced)">
    <option value="Talmud 3">
    <option value="Talmud 3 (Advanced)">
    <option value="Talmud 4">
    <option value="Talmud 4 (Advanced)">

    <option value="Hebrew Language">
    <option value="Hebrew Language (Honors)">

    <option value="SAS Eurasia">
    <option value="SAS Civil War & Reconstruction">
    <option value="SAS World War II">
    <option value="Civics">
    <option value="Comparative Government">
    <option value="U.S. History (Honors)">
    <option value="World History">

    <option value="Algebra 1">
    <option value="Algebra 2">
    <option value="Algebra 2 (Honors)">
    <option value="Geometry">
    <option value="Geometry (Honors)">
    <option value="Precalculus">
    <option value="Biology">
    <option value="Chemistry">
    <option value="Chemistry (Honors)">
    <option value="English Composition">
    <option value="English Composition (Honors)">
    <option value="American Literature">
    <option value="American Literature (Honors)">
    <option value="British Literature (SAS)">
    <option value="SAS Biology">
</datalist>

<div class="container">
    <div class="dashboard">
        <div class="gpa-stat">
            <div class="gpa-val" id="total-wt">0.00</div>
            <div class="gpa-label">Weighted Cumulative</div>
        </div>
        <div class="gpa-stat">
            <div class="gpa-val" id="total-reg">0.00</div>
            <div class="gpa-label">Unweighted (REG)</div>
        </div>
    </div>

    <div class="info-card">
        <h3>GPA Policy Overview</h3>
        <ul class="info-list">
            <li><strong>Unweighted (REG):</strong> Standard 4.0 scale.</li>
            <li><strong>Weighted (WT):</strong> Extra 1.0 point for SAS/Honors.</li>
            <li><strong>Advanced Track:</strong> Unweighted per school policy.</li>
            <li><strong>Credits:</strong> Most semester courses are 0.5 credits.</li>
        </ul>
    </div>

    <div id="table-root"></div>

    <button class="reset-btn" onclick="resetData()">Clear All Data</button>

    <div class="disclaimer-box">
        <strong>Disclaimer:</strong> Planning purposes only. Official GPA is determined by your transcript.
    </div>
</div>

<script>
const scale = { "A+": 4.0, "A": 4.0, "A-": 3.67, "B+": 3.33, "B": 3.0, "B-": 2.67, "C+": 2.33, "C": 2.0, "C-": 1.67, "D+": 1.33, "D": 1.0, "D-": 0.67, "F": 0.0 };

let data = JSON.parse(localStorage.getItem('shalhevet_save_final')) || [
    { name: "9th Grade", s1: [], s2: [] },
    { name: "10th Grade", s1: [], s2: [] },
    { name: "11th Grade", s1: [], s2: [] },
    { name: "12th Grade", s1: [], s2: [] }
];

function precisionRound(n) { return Math.round((n + 0.00001) * 100) / 100; }

function calculate() {
    let gW = 0, gU = 0, gCr = 0;
    data.forEach(y => {
        ['s1', 's2'].forEach(sK => {
            let sw = 0, su = 0, scr = 0;
            y[sK].forEach(c => {
                let p = scale[c.grade] || 0;
                let cr = parseFloat(c.credits) || 0;
                su += (p * cr);
                sw += ((p + (c.wt ? 1 : 0)) * cr);
                scr += cr;
            });
            y[sK + '_wt'] = scr > 0 ? (sw / scr) : 0;
            y[sK + '_un'] = scr > 0 ? (su / scr) : 0;
            gW += sw; gU += su; gCr += scr;
        });
    });
    document.getElementById('total-wt').innerText = precisionRound(gCr > 0 ? gW / gCr : 0).toFixed(2);
    document.getElementById('total-reg').innerText = precisionRound(gCr > 0 ? gU / gCr : 0).toFixed(2);
    localStorage.setItem('shalhevet_save_final', JSON.stringify(data));
    render();
}

function render() {
    const root = document.getElementById('table-root');
    root.innerHTML = data.map((y, yI) => `
        <div class="year-card">
            <div class="year-header"><span class="year-title">${y.name}</span></div>
            ${['s1', 's2'].map(sK => `
                <div class="sem-tag">${sK === 's1' ? 'Semester 1' : 'Semester 2'}</div>
                <table>
                    <thead>
                        <tr>
                            <th>Course</th><th width="120">Grade</th><th width="110">Credits</th><th width="100">Weight</th><th width="40"></th>
                        </tr>
                    </thead>
                    <tbody>
                        ${y[sK].map((c, cI) => `
                            <tr>
                                <td><input type="text" list="catalog" value="${c.name}" placeholder="Type or select..." oninput="update(${yI},'${sK}',${cI},'name',this.value)"></td>
                                <td><select onchange="update(${yI},'${sK}',${cI},'grade',this.value)">
                                    ${Object.keys(scale).map(g => `<option ${c.grade==g?'selected':''}>${g}</option>`).join('')}
                                </select></td>
                                <td><select onchange="update(${yI},'${sK}',${cI},'credits',this.value)">
                                    <option value="0.5" ${c.credits==0.5?'selected':''}>0.50</option>
                                    <option value="0.25" ${c.credits==0.25?'selected':''}>0.25</option>
                                    <option value="1.0" ${c.credits==1.0?'selected':''}>1.00</option>
                                </select></td>
                                <td><div class="wt-toggle ${c.wt?'active':''}" onclick="toggle(${yI},'${sK}',${cI})">${c.wt?'WT':'REG'}</div></td>
                                <td><button class="del-btn" onclick="del(${yI},'${sK}',${cI})">Ã—</button></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div class="sem-footer">
                    <div class="sem-stats">
                        <span>WT: ${precisionRound(y[sK+'_wt']).toFixed(2)}</span>
                        <span>REG: ${precisionRound(y[sK+'_un']).toFixed(2)}</span>
                    </div>
                    <button class="btn-add" onclick="add(${yI},'${sK}')">+ Add Course</button>
                </div>
            `).join('')}
        </div>
    `).join('');
}

function update(yI, sK, cI, f, v) { 
    data[yI][sK][cI][f] = v; 
    if(f === 'name') {
        let n = v.toUpperCase();
        // Weighting rules: include SAS/Honors, EXCLUDE Advanced
        data[yI][sK][cI].wt = (n.includes('SAS') || n.includes('HONORS')) && !n.includes('ADVANCED');
    }
    calculate(); 
}
function toggle(yI, sK, cI) { data[yI][sK][cI].wt = !data[yI][sK][cI].wt; calculate(); }
function add(yI, sK) { data[yI][sK].push({name:'', grade:'A', credits:0.5, wt:false}); calculate(); }
function del(yI, sK, cI) { data[yI][sK].splice(cI, 1); calculate(); }
function resetData() { if(confirm("Permanently clear all saved data?")) { localStorage.clear(); location.reload(); } }

calculate();
</script>
</body>
</html>
