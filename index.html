<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shalhevet GPA Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --fire-red: #cc0000; 
            --dark-red: #a30000;
            --black: #1a1a1a; 
            --white: #ffffff;
            --bg: #f4f4f4; 
            --border: #d1d1d1;
            --text-muted: #666666;
        }
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: var(--black); margin: 0; padding: 20px; line-height: 1.5; }
        .container { max-width: 1000px; margin: 40px auto; }
        
        /* Main Dashboard */
        .stats-bar { 
            position: sticky; top: 20px; background: var(--black); 
            padding: 25px; border-radius: 20px; 
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; 
            margin-bottom: 30px; z-index: 1000; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.2); 
            color: var(--white);
        }
        .stat-item { text-align: center; border-right: 1px solid #444; }
        .stat-item:last-child { border-right: none; }
        .stat-value { font-size: 2.8rem; font-weight: 800; color: var(--fire-red); line-height: 1; margin-bottom: 5px; }
        .stat-label { font-size: 0.75rem; text-transform: uppercase; font-weight: 600; letter-spacing: 0.15em; }

        /* Yearly Summary Indicator */
        .year-summary-bar {
            background: var(--white); border: 2px solid var(--black);
            padding: 12px 25px; border-radius: 12px; margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 800; font-size: 0.9rem; text-transform: uppercase;
        }
        .year-summary-bar span { color: var(--fire-red); }

        /* Semester Card */
        .semester-card { background: var(--white); border-radius: 20px; padding: 0; margin-bottom: 35px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .sem-header { background: #fdfdfd; padding: 15px 32px; border-bottom: 2px solid var(--bg); display: flex; justify-content: space-between; align-items: center; }
        
        .sem-title-group { display: flex; gap: 30px; align-items: center; }
        .selector-box { display: flex; flex-direction: column; gap: 4px; }
        .selector-label { font-size: 10px; font-weight: 800; color: var(--fire-red); text-transform: uppercase; letter-spacing: 0.05em; }

        .select-styled { background: var(--white); border: 1px solid var(--border); padding: 6px 10px; border-radius: 8px; font-weight: 600; font-size: 0.85rem; }

        .sem-badge { background: #eee; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; border: 1px solid #ccc; }

        /* Course Row - Extra wide name field */
        .courses-container { padding: 25px 32px; }
        .course-row { display: grid; grid-template-columns: 3.5fr 110px 85px 85px 40px; gap: 15px; margin-bottom: 15px; align-items: flex-end; }
        
        input, select { background: var(--white); border: 1px solid var(--border); padding: 10px; border-radius: 8px; font-family: inherit; font-size: 0.9rem; width: 100%; box-sizing: border-box; }
        input[type="text"] { font-weight: 500; }

        /* WT / REG Toggle */
        .weight-toggle { display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); height: 40px; border-radius: 8px; cursor: pointer; font-size: 10px; font-weight: 800; color: var(--text-muted); transition: 0.2s; }
        .weight-toggle:has(input:checked) { background: var(--fire-red); border-color: var(--fire-red); color: white; }
        .weight-toggle input { display: none; }

        button { font-family: inherit; cursor: pointer; border: none; border-radius: 10px; padding: 10px 18px; font-weight: 700; transition: 0.2s; }
        .btn-add-sem { background: var(--fire-red); color: white; width: 100%; padding: 15px; font-size: 1rem; text-transform: uppercase; }
        .btn-add-course { background: transparent; color: var(--fire-red); border: 1px dashed var(--fire-red); width: 100%; margin-top: 5px; }
        .btn-delete { color: var(--text-muted); background: none; font-size: 1.1rem; height: 40px; }
        .btn-delete:hover { color: var(--fire-red); }

        .controls { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-top: 30px; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="margin: 0; font-size: 2.2rem; font-weight: 800;">GPA <span style="color: var(--fire-red);">TRACKER</span></h1>
        <p style="color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Shalhevet High School</p>
    </div>

    <div class="stats-bar">
        <div class="stat-item"><div class="stat-label">Cumulative UW</div><div class="stat-value" id="overall-unweighted">0.00</div></div>
        <div class="stat-item"><div class="stat-label">Cumulative Weighted</div><div class="stat-value" id="overall-weighted">0.00</div></div>
    </div>

    <div id="year-indicators"></div>
    <div id="semesters-container"></div>

    <div class="controls">
        <button class="btn-add-sem" onclick="addSemester()">+ Add New Semester</button>
        <button style="background: var(--black); color: white;" onclick="copyLink()">Share Link</button>
        <button style="background: white; color: var(--black); border: 1px solid var(--black);" onclick="clearAll()">Reset All</button>
    </div>
</div>

<datalist id="course-list"></datalist>

<script>
    const schoolCourses = ["English Composition", "English Composition (Honors)", "American Literature", "American Literature (Honors)", "Banned Books", "Banned Books (Honors)", "British Literature (SAS)", "Journalism (Honors/Reg)", "Creative Writing", "Film, Literature & Composition", "Film, Literature & Composition (Honors)", "Jewish Literature (SAS)", "World History", "US History", "US History (Honors)", "Civics (SAS)", "Civil War and Reconstruction (SAS)", "Eurasia (SAS)", "Economics (SAS)", "Medieval Jewish History (SAS)", "Positive Psychology", "Psychology (SAS)", "Topics in US History (SAS)", "US Government & Economics", "Biology", "Biology (SAS)", "Chemistry", "Chemistry (Honors)", "Chemistry (SAS)", "Physics", "Physics (SAS)", "Anatomy and Physiology (Honors)", "Biochemistry (SAS)", "Environmental Science", "Computer Science Principles (Honors)", "Computer Science (SAS)", "Computer Organization (SAS)", "Engineering", "Algebra 1", "Geometry", "Geometry (Advanced)", "Geometry (Honors)", "Algebra 2", "Algebra 2 (Advanced)", "Algebra 2 (Honors)", "Precalculus", "Precalculus (Advanced)", "Precalculus (Honors)", "Calculus", "Calculus (SAS)", "Statistics (SAS)", "Multivariable Calculus (SAS)", "Visual Art", "Art Comp & Design", "Art History (Honors)", "Studio Art (SAS)", "Drama", "Hebrew Language", "Hebrew Literature (Honors)", "Hebrew Film & Literature (SAS)", "Israeli Culture & Conversation", "Jewish History", "Modern Jewish History", "Israel Ed", "Israel Ed (SAS)", "Talmud 1", "Talmud 2", "Talmud 2 (Advanced)", "Talmud 3", "Talmud 3 (Advanced)", "Talmud 4", "Talmud 4 (Advanced)", "Tanach 1", "Tanach 2", "Tanach 2 (Advanced)", "Tanach 3", "Tanach 3 (Advanced)", "Tanach 4", "Jewish Philosophy", "Advanced Jewish Philosophy", "AGS (Advanced Gemara Shiur)", "BMT (Beit Midrash Track)"];
    const gradeScale = { "A": 4.0, "A-": 3.67, "B+": 3.33, "B": 3.0, "B-": 2.67, "C+": 2.33, "C": 2.0, "C-": 1.67, "D+": 1.33, "D": 1.0, "F": 0.0 };
    const years = ["9th Grade", "10th Grade", "11th Grade", "12th Grade"];

    let semesters = JSON.parse(localStorage.getItem('shalhevet_vFinal')) || [];

    function save() {
        localStorage.setItem('shalhevet_vFinal', JSON.stringify(semesters));
        calculateAndRender();
    }

    function addSemester() {
        const lastYear = semesters.length > 0 ? semesters[semesters.length-1].year : years[0];
        semesters.push({ id: Date.now(), year: lastYear, term: "Semester 1", courses: [{ name: '', grade: 'A', credits: 1.0, isHonors: false }] });
        save();
    }

    function updateCourse(semId, idx, field, value) {
        const sem = semesters.find(s => s.id === semId);
        sem.courses[idx][field] = value;
        if (field === 'name') {
            const n = value.toLowerCase();
            sem.courses[idx].isHonors = (n.includes("honors") || n.includes("sas"));
        }
        save();
    }

    function calculateAndRender() {
        let totalCredits = 0, totalUwPts = 0, totalWPts = 0;
        let yearStats = {};

        semesters.forEach(sem => {
            let sCreds = 0, sUw = 0, sW = 0;
            sem.courses.forEach(c => {
                const cr = parseFloat(c.credits) || 0;
                const val = gradeScale[c.grade] || 0;
                const wt = (c.isHonors && val >= 1.67) ? 1.0 : 0;
                sCreds += cr; sUw += (val * cr); sW += ((val + wt) * cr);
            });
            sem.semUw = sCreds ? (sUw / sCreds).toFixed(2) : "0.00";
            sem.semW = sCreds ? (sW / sCreds).toFixed(2) : "0.00";

            if (!yearStats[sem.year]) yearStats[sem.year] = { creds: 0, uw: 0, w: 0 };
            yearStats[sem.year].creds += sCreds;
            yearStats[sem.year].uw += sUw;
            yearStats[sem.year].w += sW;

            totalCredits += sCreds; totalUwPts += sUw; totalWPts += sW;
        });

        document.getElementById('overall-unweighted').innerText = totalCredits ? (totalUwPts / totalCredits).toFixed(2) : "0.00";
        document.getElementById('overall-weighted').innerText = totalCredits ? (totalWPts / totalCredits).toFixed(2) : "0.00";

        // Render Year Bars
        const yearBox = document.getElementById('year-indicators');
        yearBox.innerHTML = years.map(y => {
            if (!yearStats[y]) return '';
            const yUw = (yearStats[y].uw / yearStats[y].creds).toFixed(2);
            const yW = (yearStats[y].w / yearStats[y].creds).toFixed(2);
            return `<div class="year-summary-bar">${y} GPA <span>UW: ${yUw} | W: ${yW}</span></div>`;
        }).join('');

        renderSemesters();
    }

    function renderSemesters() {
        const container = document.getElementById('semesters-container');
        container.innerHTML = '';
        semesters.forEach(sem => {
            const div = document.createElement('div');
            div.className = 'semester-card';
            div.innerHTML = `
                <div class="sem-header">
                    <div class="sem-title-group">
                        <div class="selector-box"><span class="selector-label">Grade</span>
                            <select class="select-styled" onchange="updateSemInfo(${sem.id}, 'year', this.value)">
                                ${years.map(y => `<option value="${y}" ${sem.year === y ? 'selected' : ''}>${y}</option>`).join('')}
                            </select>
                        </div>
                        <div class="selector-box"><span class="selector-label">Term</span>
                            <select class="select-styled" onchange="updateSemInfo(${sem.id}, 'term', this.value)">
                                <option ${sem.term === 'Semester 1' ? 'selected' : ''}>Semester 1</option>
                                <option ${sem.term === 'Semester 2' ? 'selected' : ''}>Semester 2</option>
                            </select>
                        </div>
                    </div>
                    <div style="display:flex; gap:10px; align-items:center">
                        <div class="sem-badge">Sem UW: ${sem.semUw}</div>
                        <div class="sem-badge">Sem W: ${sem.semW}</div>
                        <button class="btn-delete" onclick="deleteSem(${sem.id})">✕</button>
                    </div>
                </div>
                <div class="courses-container">
                    ${sem.courses.map((c, i) => `
                        <div class="course-row">
                            <div class="selector-box"><span class="selector-label">Course Name</span>
                                <input type="text" list="course-list" value="${c.name}" onchange="updateCourse(${sem.id}, ${i}, 'name', this.value)">
                            </div>
                            <div class="selector-box"><span class="selector-label">Grade</span>
                                <select onchange="updateCourse(${sem.id}, ${i}, 'grade', this.value)">
                                    ${Object.keys(gradeScale).map(g => `<option value="${g}" ${c.grade === g ? 'selected' : ''}>${g}</option>`).join('')}
                                </select>
                            </div>
                            <div class="selector-box"><span class="selector-label">Credits</span>
                                <input type="number" step="0.1" value="${c.credits}" oninput="updateCourse(${sem.id}, ${i}, 'credits', this.value)">
                            </div>
                            <div class="selector-box"><span class="selector-label">Weight</span>
                                <label class="weight-toggle">
                                    <input type="checkbox" ${c.isHonors ? 'checked' : ''} onchange="updateCourse(${sem.id}, ${i}, 'isHonors', this.checked)">
                                    ${c.isHonors ? 'WT' : 'REG'}
                                </label>
                            </div>
                            <button class="btn-delete" onclick="deleteCourse(${sem.id}, ${i})">✕</button>
                        </div>
                    `).join('')}
                    <button class="btn-add-course" onclick="addCourse(${sem.id})">+ Add Course</button>
                </div>`;
            container.appendChild(div);
        });
        document.getElementById('course-list').innerHTML = schoolCourses.map(c => `<option value="${c}">`).join('');
    }

    function updateSemInfo(id, f, v) { semesters.find(s => s.id === id)[f] = v; save(); }
    function addCourse(id) { semesters.find(s => s.id === id).courses.push({ name: '', grade: 'A', credits: 1.0, isHonors: false }); save(); }
    function deleteCourse(id, i) { semesters.find(s => s.id === id).courses.splice(i, 1); save(); }
    function deleteSem(id) { if(confirm("Delete semester?")) { semesters = semesters.filter(s => s.id !== id); save(); } }
    function copyLink() { navigator.clipboard.writeText(window.location.href); alert("Link Copied!"); }
    function clearAll() { if(confirm("Reset everything?")) { semesters = []; addSemester(); } }

    if(semesters.length === 0) addSemester(); else calculateAndRender();
</script>
</body>
</html>
