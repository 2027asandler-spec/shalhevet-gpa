<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shalhevet GPA Tracker | Verified v5</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --fire-red: #cc0000; 
            --black: #1a1a1a; 
            --white: #ffffff;
            --bg: #f4f4f4; 
            --border: #d1d1d1;
            --text-muted: #666666;
        }
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: var(--black); margin: 0; padding: 20px; line-height: 1.5; }
        .container { max-width: 1000px; margin: 40px auto; }
        
        /* Cumulative Header */
        .stats-bar { 
            position: sticky; top: 20px; background: var(--black); 
            padding: 25px; border-radius: 20px; 
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; 
            margin-bottom: 30px; z-index: 1000; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.2); 
            color: var(--white);
        }
        .stat-item { text-align: center; border-right: 1px solid #444; }
        .stat-item:last-child { border-right: none; }
        .stat-value { font-size: 2.8rem; font-weight: 800; color: var(--fire-red); line-height: 1; margin-bottom: 5px; }
        .stat-label { font-size: 0.75rem; text-transform: uppercase; font-weight: 600; letter-spacing: 0.15em; }

        /* Yearly Summary Logic (Appears after semesters) */
        .year-summary-bar {
            background: #e2e2e2; border: 2px solid var(--black);
            padding: 15px 25px; border-radius: 12px; margin: -10px 0 35px 0;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 800; font-size: 0.95rem; text-transform: uppercase;
        }
        .year-summary-bar span { color: var(--fire-red); }

        /* Semester UI */
        .semester-card { background: var(--white); border-radius: 20px; margin-bottom: 25px; border: 1px solid var(--border); overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .sem-header { background: #fdfdfd; padding: 15px 32px; border-bottom: 2px solid var(--bg); display: flex; justify-content: space-between; align-items: center; }
        
        .sem-title-group { display: flex; gap: 20px; align-items: center; }
        .selector-box { display: flex; flex-direction: column; gap: 4px; }
        .selector-label { font-size: 10px; font-weight: 800; color: var(--fire-red); text-transform: uppercase; }
        .select-styled { background: var(--white); border: 1px solid var(--border); padding: 6px 10px; border-radius: 8px; font-weight: 600; font-size: 0.85rem; }
        .sem-badge { background: #eee; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; border: 1px solid #ccc; }

        /* Course Layout */
        .courses-container { padding: 25px 32px; }
        .course-row { display: grid; grid-template-columns: 3.5fr 110px 85px 85px 40px; gap: 15px; margin-bottom: 15px; align-items: flex-end; }
        
        input, select { background: var(--white); border: 1px solid var(--border); padding: 10px; border-radius: 8px; font-family: inherit; font-size: 0.9rem; width: 100%; box-sizing: border-box; }

        /* Weight Button */
        .weight-toggle { display: flex; align-items: center; justify-content: center; border: 1px solid var(--border); height: 40px; border-radius: 8px; cursor: pointer; font-size: 10px; font-weight: 800; color: var(--text-muted); transition: 0.2s; }
        .weight-toggle:has(input:checked) { background: var(--fire-red); border-color: var(--fire-red); color: white; }
        .weight-toggle input { display: none; }

        /* Actions */
        button { font-family: inherit; cursor: pointer; border: none; border-radius: 10px; padding: 10px 18px; font-weight: 700; transition: 0.2s; }
        .btn-add-sem { background: var(--fire-red); color: white; width: 100%; padding: 15px; font-size: 1rem; text-transform: uppercase; margin-bottom: 40px; }
        .btn-add-course { background: transparent; color: var(--fire-red); border: 1px dashed var(--fire-red); width: 100%; margin-top: 5px; }
        .btn-delete { color: var(--text-muted); background: none; font-size: 1.1rem; height: 40px; }
        .btn-delete:hover { color: var(--fire-red); }

        .controls { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-top: 30px; border-bottom: 2px solid var(--border); padding-bottom: 40px; margin-bottom: 40px; }

        /* Info & Chart */
        .info-section { background: var(--white); border-radius: 20px; padding: 40px; border: 1px solid var(--border); }
        .info-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 40px; }
        .gpa-chart { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .gpa-chart th { text-align: left; padding: 12px; border-bottom: 2px solid var(--fire-red); font-weight: 800; text-transform: uppercase; }
        .gpa-chart td { padding: 10px; border-bottom: 1px solid var(--bg); }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="margin: 0; font-size: 2.2rem; font-weight: 800;">GPA <span style="color: var(--fire-red);">TRACKER</span></h1>
        <p style="color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">Overall School Year</p>
    </div>

    <div class="stats-bar">
        <div class="stat-item"><div class="stat-label">Cumulative UW</div><div class="stat-value" id="overall-unweighted">0.00</div></div>
        <div class="stat-item"><div class="stat-label">Cumulative Weighted</div><div class="stat-value" id="overall-weighted">0.00</div></div>
    </div>

    <div id="main-content"></div>

    <div class="controls">
        <button class="btn-add-sem" onclick="addSemester()">+ Add New Semester</button>
        <button style="background: var(--black); color: white;" onclick="copyLink()">Share Link</button>
        <button style="background: white; color: var(--black); border: 1px solid var(--black);" onclick="clearAll()">Reset All</button>
    </div>

    <div class="info-section">
        <div class="info-grid">
            <div>
                <h3 style="margin-top:0; color: var(--fire-red);">System Logic</h3>
                <p style="font-size: 0.9rem;">This tracker follows Shalhevet High School grading standards. GPA is calculated by total points earned divided by total credits attempted.</p>
                <ul style="font-size: 0.85rem; padding-left: 20px; color: var(--text-muted);">
                    <li><b>Unweighted - REG:</b> Based on a standard 4.00 scale.</li>
                    <li><b>Weighted - WT:</b> Extra +1.0 point for Honors/SAS courses.</li>
                    <li><b>Advanced:</b> Unweighted per school policy.</li>
                </ul>
            </div>
            <div>
                <table class="gpa-chart">
                    <thead><tr><th>Grade</th><th>Points</th><th>SAS/Honors</th></tr></thead>
                    <tbody>
                        <tr><td>A / A+</td><td>4.00</td><td>5.00</td></tr>
                        <tr><td>A-</td><td>3.67</td><td>4.67</td></tr>
                        <tr><td>B+</td><td>3.33</td><td>4.33</td></tr>
                        <tr><td>B</td><td>3.00</td><td>4.00</td></tr>
                        <tr><td>B-</td><td>2.67</td><td>3.67</td></tr>
                        <tr><td>C+</td><td>2.33</td><td>3.33</td></tr>
                        <tr><td>C</td><td>2.00</td><td>3.00</td></tr>
                        <tr><td>C-</td><td>1.67</td><td>2.67</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<datalist id="course-list"></datalist>

<script>
    const schoolCourses = ["English Composition", "American Literature", "Banned Books", "British Literature (SAS)", "Journalism", "Creative Writing", "Film, Lit & Comp", "World History", "US History", "US History (Honors)", "Civics (SAS)", "Eurasia (SAS)", "Economics (SAS)", "Medieval Jewish History (SAS)", "Positive Psych", "Psychology (SAS)", "Biology (SAS)", "Chemistry (Honors)", "Chemistry (SAS)", "Physics (SAS)", "Anatomy (Honors)", "Engineering", "Algebra 1", "Geometry", "Geometry (Advanced)", "Algebra 2 (Honors)", "Precalculus (Advanced)", "Calculus (SAS)", "Statistics (SAS)", "Hebrew Language", "Hebrew Film (SAS)", "Jewish History", "Modern Jewish History", "Israel Ed (SAS)", "Talmud (Advanced)", "Tanach (Advanced)", "Jewish Philosophy", "AGS (Advanced Gemara Shiur)"];
    const gradeScale = { "A": 4.0, "A-": 3.67, "B+": 3.33, "B": 3.0, "B-": 2.67, "C+": 2.33, "C": 2.0, "C-": 1.67, "D+": 1.33, "D": 1.0, "F": 0.0 };
    const years = ["9th Grade", "10th Grade", "11th Grade", "12th Grade"];

    let semesters = JSON.parse(localStorage.getItem('shalhevet_master_v5')) || [];

    function save() {
        localStorage.setItem('shalhevet_master_v5', JSON.stringify(semesters));
        calculateAndRender();
    }

    // Precise Verify Function
    function preciseRound(num) {
        return Math.round((num + Number.EPSILON) * 100) / 100;
    }

    function addSemester() {
        const lastYear = semesters.length > 0 ? semesters[semesters.length-1].year : years[0];
        semesters.push({ id: Date.now(), year: lastYear, term: "Semester 1", courses: [{ name: '', grade: 'A', credits: 0.5, isHonors: false }] });
        save();
    }

    function updateCourse(semId, idx, field, value) {
        const sem = semesters.find(s => s.id === semId);
        sem.courses[idx][field] = value;
        if (field === 'name') {
            const n = value.toLowerCase();
            sem.courses[idx].isHonors = (n.includes("honors") || n.includes("sas"));
        }
        save();
    }

    function calculateAndRender() {
        let totalCredits = 0, totalUwPts = 0, totalWPts = 0;
        let yearStats = {};

        semesters.forEach(sem => {
            let sCreds = 0, sUw = 0, sW = 0;
            sem.courses.forEach(c => {
                const cr = parseFloat(c.credits) || 0;
                const val = gradeScale[c.grade] || 0;
                const wt = (c.isHonors && val >= 1.67) ? 1.0 : 0;
                sCreds += cr; sUw += (val * cr); sW += ((val + wt) * cr);
            });
            sem.semUw = sCreds ? preciseRound(sUw / sCreds).toFixed(2) : "0.00";
            sem.semW = sCreds ? preciseRound(sW / sCreds).toFixed(2) : "0.00";

            if (!yearStats[sem.year]) yearStats[sem.year] = { creds: 0, uw: 0, w: 0 };
            yearStats[sem.year].creds += sCreds;
            yearStats[sem.year].uw += sUw;
            yearStats[sem.year].w += sW;

            totalCredits += sCreds; totalUwPts += sUw; totalWPts += sW;
        });

        document.getElementById('overall-unweighted').innerText = totalCredits ? preciseRound(totalUwPts / totalCredits).toFixed(2) : "0.00";
        document.getElementById('overall-weighted').innerText = totalCredits ? preciseRound(totalWPts / totalCredits).toFixed(2) : "0.00";

        renderMainContent(yearStats);
    }

    function renderMainContent(yearStats) {
        const container = document.getElementById('main-content');
        container.innerHTML = '';
        years.forEach(year => {
            const yearSems = semesters.filter(s => s.year === year);
            if (yearSems.length === 0) return;
            yearSems.forEach(sem => {
                const semDiv = document.createElement('div');
                semDiv.className = 'semester-card';
                semDiv.innerHTML = `
                    <div class="sem-header">
                        <div class="sem-title-group">
                            <div class="selector-box"><span class="selector-label">Grade Level</span>
                                <select class="select-styled" onchange="updateSemInfo(${sem.id}, 'year', this.value)">
                                    ${years.map(y => `<option value="${y}" ${sem.year === y ? 'selected' : ''}>${y}</option>`).join('')}
                                </select>
                            </div>
                            <div class="selector-box"><span class="selector-label">Term</span>
                                <select class="select-styled" onchange="updateSemInfo(${sem.id}, 'term', this.value)">
                                    <option ${sem.term === 'Semester 1' ? 'selected' : ''}>Semester 1</option>
                                    <option ${sem.term === 'Semester 2' ? 'selected' : ''}>Semester 2</option>
                                </select>
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; align-items:center">
                            <div class="sem-badge">UW: ${sem.semUw}</div>
                            <div class="sem-badge">W: ${sem.semW}</div>
                            <button class="btn-delete" onclick="deleteSem(${sem.id})">✕</button>
                        </div>
                    </div>
                    <div class="courses-container">
                        ${sem.courses.map((c, i) => `
                            <div class="course-row">
                                <div class="selector-box"><span class="selector-label">Course Name</span>
                                    <input type="text" list="course-list" value="${c.name}" onchange="updateCourse(${sem.id}, ${i}, 'name', this.value)">
                                </div>
                                <div class="selector-box"><span class="selector-label">Grade</span>
                                    <select onchange="updateCourse(${sem.id}, ${i}, 'grade', this.value)">
                                        ${Object.keys(gradeScale).map(g => `<option value="${g}" ${c.grade === g ? 'selected' : ''}>${g}</option>`).join('')}
                                    </select>
                                </div>
                                <div class="selector-box"><span class="selector-label">Credits</span>
                                    <input type="number" step="0.1" value="${c.credits}" oninput="updateCourse(${sem.id}, ${i}, 'credits', this.value)">
                                </div>
                                <div class="selector-box"><span class="selector-label">Weight</span>
                                    <label class="weight-toggle">
                                        <input type="checkbox" ${c.isHonors ? 'checked' : ''} onchange="updateCourse(${sem.id}, ${i}, 'isHonors', this.checked)">
                                        ${c.isHonors ? 'WT' : 'REG'}
                                    </label>
                                </div>
                                <button class="btn-delete" onclick="deleteCourse(${sem.id}, ${i})">✕</button>
                            </div>
                        `).join('')}
                        <button class="btn-add-course" onclick="addCourse(${sem.id})">+ Add Course</button>
                    </div>`;
                container.appendChild(semDiv);
            });
            const yUw = preciseRound(yearStats[year].uw / yearStats[year].creds).toFixed(2);
            const yW = preciseRound(yearStats[year].w / yearStats[year].creds).toFixed(2);
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'year-summary-bar';
            summaryDiv.innerHTML = `${year} TOTAL GPA <span>UW: ${yUw} | W: ${yW}</span>`;
            container.appendChild(summaryDiv);
        });
        document.getElementById('course-list').innerHTML = schoolCourses.map(c => `<option value="${c}">`).join('');
    }

    function updateSemInfo(id, f, v) { semesters.find(s => s.id === id)[f] = v; save(); }
    function addCourse(id) { semesters.find(s => s.id === id).courses.push({ name: '', grade: 'A', credits: 0.5, isHonors: false }); save(); }
    function deleteCourse(id, i) { semesters.find(s => s.id === id).courses.splice(i, 1); save(); }
    function deleteSem(id) { if(confirm("Delete entire semester?")) { semesters = semesters.filter(s => s.id !== id); save(); } }
    function copyLink() { navigator.clipboard.writeText(window.location.href); alert("Tracker Link Copied!"); }
    function clearAll() { if(confirm("Wipe all data?")) { semesters = []; addSemester(); } }

    if(semesters.length === 0) addSemester(); else calculateAndRender();
</script>
</body>
</html>
